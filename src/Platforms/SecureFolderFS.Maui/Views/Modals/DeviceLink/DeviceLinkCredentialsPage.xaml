<md:BaseModalPage
    x:Class="SecureFolderFS.Maui.Views.Modals.DeviceLink.DeviceLinkCredentialsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:l="using:SecureFolderFS.Maui.Localization"
    xmlns:local="clr-namespace:SecureFolderFS.Maui.Views.Modals.DeviceLink"
    xmlns:md="clr-namespace:SecureFolderFS.Maui.Views.Modals"
    xmlns:mi="http://www.aathifmahir.com/dotnet/2022/maui/icons"
    xmlns:mi_cupertino="clr-namespace:MauiIcons.Cupertino;assembly=MauiIcons.Cupertino"
    xmlns:mi_material="clr-namespace:MauiIcons.Material;assembly=MauiIcons.Material"
    xmlns:uco="clr-namespace:SecureFolderFS.Maui.UserControls.Options"
    xmlns:vm="clr-namespace:SecureFolderFS.Sdk.ViewModels.Controls.Components;assembly=SecureFolderFS.Sdk"
    x:Name="ThisPage"
    Title="{l:ResourceString Rid=DeviceLink}"
    x:DataType="local:DeviceLinkCredentialsPage">

    <md:BaseModalPage.ModalContent>
        <Grid
            Margin="{OnPlatform iOS='0,16,0,0'}"
            Padding="16,0"
            RowSpacing="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition />
            </Grid.RowDefinitions>

            <!--  Hero card  -->
            <Border
                Grid.Row="0"
                Padding="20,20"
                Background="{StaticResource ThemeSecondaryColorBrush}"
                StrokeThickness="0">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="16" />
                </Border.StrokeShape>
                <Grid ColumnDefinitions="Auto,*" ColumnSpacing="14">
                    <Border
                        Grid.Column="0"
                        Background="{StaticResource ThemePrimaryColorBrush}"
                        HeightRequest="48"
                        StrokeThickness="0"
                        VerticalOptions="Center"
                        WidthRequest="48">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="12" />
                        </Border.StrokeShape>
                        <Grid>
                            <mi:MauiIcon
                                HorizontalOptions="Center"
                                Icon="{mi_material:Material Devices}"
                                IconColor="White"
                                IconSize="24"
                                OnPlatforms="Android"
                                VerticalOptions="Center" />
                            <mi:MauiIcon
                                HorizontalOptions="Center"
                                Icon="{mi_cupertino:Cupertino Desktopcomputer}"
                                IconColor="White"
                                IconSize="24"
                                OnPlatforms="iOS"
                                VerticalOptions="Center" />
                        </Grid>
                    </Border>
                    <VerticalStackLayout
                        Grid.Column="1"
                        Spacing="3"
                        VerticalOptions="Center">
                        <Label
                            FontAttributes="Bold"
                            FontSize="15"
                            Text="{l:ResourceString Rid=DeviceLink}" />
                        <Label
                            FontSize="13"
                            LineBreakMode="WordWrap"
                            Opacity="0.55"
                            Text="{l:ResourceString Rid=DeviceLinkDescription}" />
                    </VerticalStackLayout>
                </Grid>
            </Border>

            <!--  Rest of content  -->
            <Grid
                Grid.Row="1"
                RowDefinitions="Auto,Auto,*"
                RowSpacing="8">
                <!--  Enable Device Link toggle  -->
                <uco:OptionsContainer Grid.Row="0">
                    <uco:OptionsContainer.InnerContent>
                        <uco:OptionsControl
                            Title="{l:ResourceString Rid=EnableDeviceLink}"
                            ApplySlotOpacity="False"
                            IsSeparatorVisible="False">
                            <uco:OptionsControl.Slot>
                                <Switch IsToggled="{Binding ViewModel.EnableDeviceLink, Mode=TwoWay}" />
                            </uco:OptionsControl.Slot>
                        </uco:OptionsControl>
                    </uco:OptionsContainer.InnerContent>
                </uco:OptionsContainer>

                <!--  Pairing request card  -->
                <Border
                    Grid.Row="1"
                    Padding="16"
                    Background="{StaticResource ThemeElevatedFillPrimaryColorBrush}"
                    IsVisible="{Binding ViewModel.IsAwaitingPairing, Mode=OneWay}"
                    StrokeThickness="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="14" />
                    </Border.StrokeShape>
                    <VerticalStackLayout Spacing="20">
                        <VerticalStackLayout Spacing="4">
                            <Label
                                FontAttributes="Bold"
                                FontSize="16"
                                Text="{l:ResourceString Rid=PendingPairingRequest}" />
                            <Label
                                FontSize="13"
                                LineBreakMode="WordWrap"
                                Opacity="0.6"
                                Text="{Binding ViewModel.PendingDesktopName, Mode=OneWay, Converter={StaticResource StringInterpolationConverter}, ConverterParameter='inverseMode:LOCALIZE|DeviceRequestingToPair'}" />
                        </VerticalStackLayout>

                        <!--  Verification code  -->
                        <Border
                            Padding="12"
                            Background="{StaticResource ThemeBackgroundFillSecondaryColorBrush}"
                            StrokeThickness="0">
                            <Border.StrokeShape>
                                <RoundRectangle CornerRadius="10" />
                            </Border.StrokeShape>
                            <VerticalStackLayout Spacing="4">
                                <Label
                                    FontSize="11"
                                    HorizontalOptions="Center"
                                    Opacity="0.55"
                                    Text="{l:ResourceString Rid=VerificationCode}"
                                    TextTransform="Uppercase" />
                                <Label
                                    FontAttributes="Bold"
                                    FontSize="32"
                                    HorizontalOptions="Center"
                                    Text="{Binding ViewModel.VerificationCode, Mode=OneWay}"
                                    TextColor="{AppThemeBinding Light={StaticResource PrimaryLightColor},
                                                                Dark={StaticResource PrimaryDarkColor}}" />
                                <Label
                                    FontSize="11"
                                    HorizontalOptions="Center"
                                    Opacity="0.55"
                                    Text="{l:ResourceString Rid=ConfirmBothCodesMatch}" />
                            </VerticalStackLayout>
                        </Border>

                        <!--  Accept/Reject  -->
                        <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                            <Button
                                Grid.Column="0"
                                Command="{Binding ViewModel.AcceptPairingCommand, Mode=OneWay}"
                                Style="{StaticResource AccentButtonStyle}"
                                Text="{l:ResourceString Rid=Accept}" />
                            <Button
                                Grid.Column="1"
                                Command="{Binding ViewModel.RejectPairingCommand, Mode=OneWay}"
                                HorizontalOptions="Fill"
                                Text="{l:ResourceString Rid=Reject}" />
                        </Grid>
                    </VerticalStackLayout>
                </Border>

                <!--  Enrolled credentials  -->
                <uco:OptionsContainer Title="{l:ResourceString Rid=EnrolledCredentials}" Grid.Row="2">
                    <uco:OptionsContainer.InnerContent>
                        <CollectionView ItemsSource="{Binding ViewModel.Credentials, Mode=OneWay}">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="vm:DeviceLinkItemViewModel">
                                    <SwipeView Background="{StaticResource ThemeElevatedFillPrimaryColorBrush}">
                                        <SwipeView.RightItems>
                                            <SwipeItem
                                                BackgroundColor="Red"
                                                Command="{Binding ViewModel.DeleteCredentialCommand, Source={x:Reference ThisPage}}"
                                                CommandParameter="{Binding}"
                                                IsDestructive="True"
                                                Text="{l:ResourceString Rid=Remove}" />
                                        </SwipeView.RightItems>
                                        <uco:OptionsControl>
                                            <uco:OptionsControl.LeftSlot>
                                                <HorizontalStackLayout Spacing="16">
                                                    <Image
                                                        HeightRequest="32"
                                                        Source="{Binding Icon, Mode=OneWay, Converter={StaticResource ImageToSourceConverter}}"
                                                        VerticalOptions="Center"
                                                        WidthRequest="40" />
                                                    <VerticalStackLayout VerticalOptions="Center">
                                                        <Label Text="{Binding CredentialViewModel.VaultName, Mode=OneWay}" />
                                                        <Label
                                                            FontSize="11"
                                                            Opacity="0.8"
                                                            Text="{Binding CredentialViewModel.CreatedAt, Mode=OneWay, Converter={StaticResource DateTimeToStringConverter}}" />
                                                    </VerticalStackLayout>
                                                </HorizontalStackLayout>
                                            </uco:OptionsControl.LeftSlot>
                                            <uco:OptionsControl.Slot>
                                                <Label
                                                    FontSize="12"
                                                    Opacity="0.8"
                                                    Text="{Binding CredentialViewModel.CredentialId, Converter={StaticResource SubstringConverter}, ConverterParameter='0,8'}"
                                                    VerticalOptions="Center" />
                                            </uco:OptionsControl.Slot>
                                        </uco:OptionsControl>
                                    </SwipeView>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                            <CollectionView.EmptyView>
                                <Label
                                    Margin="32"
                                    FontSize="14"
                                    HorizontalOptions="Center"
                                    HorizontalTextAlignment="Center"
                                    Opacity="0.45"
                                    Text="{l:ResourceString Rid=NoItems}" />
                            </CollectionView.EmptyView>
                        </CollectionView>
                    </uco:OptionsContainer.InnerContent>
                </uco:OptionsContainer>
            </Grid>
        </Grid>
    </md:BaseModalPage.ModalContent>
</md:BaseModalPage>
