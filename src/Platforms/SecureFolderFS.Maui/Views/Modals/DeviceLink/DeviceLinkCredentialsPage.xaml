<md:BaseModalPage
    x:Class="SecureFolderFS.Maui.Views.Modals.DeviceLink.DeviceLinkCredentialsPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:l="using:SecureFolderFS.Maui.Localization"
    xmlns:local="clr-namespace:SecureFolderFS.Maui.Views.Modals.DeviceLink"
    xmlns:md="clr-namespace:SecureFolderFS.Maui.Views.Modals"
    xmlns:uco="clr-namespace:SecureFolderFS.Maui.UserControls.Options"
    xmlns:vm="clr-namespace:SecureFolderFS.Sdk.PhoneLink.ViewModels;assembly=SecureFolderFS.Sdk.PhoneLink"
    x:Name="ThisPage"
    Title="{l:ResourceString Rid=DeviceLink}"
    x:DataType="local:DeviceLinkCredentialsPage">

    <md:BaseModalPage.ModalContent>
        <Grid
            Margin="{OnPlatform iOS='0,16,0,0'}"
            Padding="16,0"
            RowSpacing="16">

            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition />
            </Grid.RowDefinitions>

            <!--  Enable Phone Link  -->
            <uco:OptionsContainer Grid.Row="0">
                <uco:OptionsContainer.InnerContent>
                    <uco:OptionsControl
                        Title="Enable Device Link"
                        ApplySlotOpacity="False"
                        IsSeparatorVisible="False">
                        <uco:OptionsControl.Slot>
                            <Switch IsToggled="{Binding ViewModel.EnablePhoneLink, Mode=TwoWay}" />
                        </uco:OptionsControl.Slot>
                    </uco:OptionsControl>
                </uco:OptionsContainer.InnerContent>
            </uco:OptionsContainer>

            <!--  Pairing request  -->
            <Border
                Grid.Row="1"
                Padding="16"
                Background="{StaticResource ThemeElevatedFillPrimaryColorBrush}"
                IsVisible="{Binding ViewModel.IsAwaitingPairing, Mode=OneWay}">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="12" />
                </Border.StrokeShape>
                <VerticalStackLayout Spacing="24">
                    <VerticalStackLayout Spacing="8">
                        <Label
                            FontAttributes="Bold"
                            FontSize="18"
                            Text="Pending pairing request" />

                        <Label Opacity="0.8" Text="{Binding ViewModel.PendingDesktopName, StringFormat='{0} is requesting to pair to create credentials', Mode=OneWay}" />
                    </VerticalStackLayout>

                    <Border
                        Padding="8"
                        Background="{StaticResource ThemeBackgroundFillSecondaryColorBrush}"
                        Shadow="0 0 4 Black">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="8" />
                        </Border.StrokeShape>

                        <VerticalStackLayout Spacing="4">
                            <Label
                                FontSize="12"
                                HorizontalOptions="Center"
                                Opacity="0.8"
                                Text="{l:ResourceString Rid=VerificationCode}" />
                            <Label
                                FontAttributes="Bold"
                                FontSize="32"
                                HorizontalOptions="Center"
                                Text="{Binding ViewModel.VerificationCode, Mode=OneWay}" />
                            <Label
                                FontSize="12"
                                HorizontalOptions="Center"
                                Opacity="0.8"
                                Text="{l:ResourceString Rid=ConfirmBothCodesMatch}" />
                        </VerticalStackLayout>
                    </Border>

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                        <Button
                            Grid.Column="0"
                            Command="{Binding ViewModel.AcceptPairingCommand, Mode=OneWay}"
                            Style="{StaticResource AccentButtonStyle}"
                            Text="{l:ResourceString Rid=Accept}" />
                        <Button
                            Grid.Column="1"
                            Command="{Binding ViewModel.RejectPairingCommand, Mode=OneWay}"
                            HorizontalOptions="Fill"
                            Text="{l:ResourceString Rid=Reject}" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!--  Enrolled credentials  -->
            <uco:OptionsContainer Title="Enrolled credentials" Grid.Row="2">
                <uco:OptionsContainer.InnerContent>
                    <CollectionView ItemsSource="{Binding ViewModel.Credentials, Mode=OneWay}">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="vm:CredentialViewModel">
                                <SwipeView Background="{StaticResource ThemeElevatedFillPrimaryColorBrush}">
                                    <SwipeView.RightItems>
                                        <SwipeItem
                                            BackgroundColor="Red"
                                            Command="{Binding ViewModel.DeleteCredentialCommand, Source={x:Reference ThisPage}}"
                                            CommandParameter="{Binding}"
                                            IsDestructive="True"
                                            Text="{l:ResourceString Rid=Remove}" />
                                    </SwipeView.RightItems>
                                    <uco:OptionsControl>
                                        <uco:OptionsControl.LeftSlot>
                                            <VerticalStackLayout Padding="16,8">
                                                <Label Text="{Binding VaultName, Mode=OneWay}" />
                                                <Label Opacity="0.8" Text="{Binding CreatedAt, StringFormat='{0:g}', Mode=OneWay}" />
                                            </VerticalStackLayout>
                                        </uco:OptionsControl.LeftSlot>
                                    </uco:OptionsControl>
                                </SwipeView>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                        <CollectionView.EmptyView>
                            <Label
                                Margin="32"
                                HorizontalOptions="Center"
                                Opacity="0.8"
                                Text="No credentials yet. Pair with desktop to create one." />
                        </CollectionView.EmptyView>
                    </CollectionView>
                </uco:OptionsContainer.InnerContent>
            </uco:OptionsContainer>
        </Grid>
    </md:BaseModalPage.ModalContent>
</md:BaseModalPage>
