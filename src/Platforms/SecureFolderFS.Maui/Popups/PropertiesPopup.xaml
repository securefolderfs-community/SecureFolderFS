<tv:Popup
    x:Class="SecureFolderFS.Maui.Popups.PropertiesPopup"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:l="using:SecureFolderFS.Maui.Localization"
    xmlns:tv="clr-namespace:CommunityToolkit.Maui.Views;assembly=CommunityToolkit.Maui"
    xmlns:uc="clr-namespace:SecureFolderFS.Maui.UserControls.Browser"
    x:Name="ThisPopup"
    Margin="0"
    Padding="0"
    BackgroundColor="Transparent"
    BindingContext="{x:Reference ThisPopup}">

    <tv:Popup.Shadow>
        <Shadow
            Opacity="0.2"
            Radius="24"
            Offset="0,4" />
    </tv:Popup.Shadow>

    <Border
        Margin="20,0"
        Padding="0"
        Background="{AppThemeBinding Light={StaticResource BackgroundFillPrimaryLightColor},
                                     Dark={StaticResource ElevatedFillPrimaryDarkColor}}"
        HorizontalOptions="Fill"
        StrokeThickness="0"
        VerticalOptions="Center">
        <Border.StrokeShape>
            <RoundRectangle CornerRadius="16" />
        </Border.StrokeShape>

        <VerticalStackLayout Spacing="0">

            <!--  Header  -->
            <Grid
                Padding="16,16,12,16"
                ColumnDefinitions="Auto,*"
                ColumnSpacing="14">

                <!--  Icon plate  -->
                <Border
                    Grid.Column="0"
                    Background="{StaticResource ThemeSecondaryColorBrush}"
                    HeightRequest="56"
                    StrokeThickness="0"
                    WidthRequest="56">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    <ContentView
                        x:Name="ImageView"
                        BindingContext="{Binding ViewModel}"
                        Content="{Binding Thumbnail, Converter={StaticResource FileIconConverter}, ConverterParameter={x:Reference ImageView}}"
                        HeightRequest="36"
                        HorizontalOptions="Center"
                        VerticalOptions="Center"
                        WidthRequest="36" />
                </Border>

                <!--  Title + type hint  -->
                <VerticalStackLayout
                    Grid.Column="1"
                    Spacing="2"
                    VerticalOptions="Center">
                    <Label
                        FontAttributes="Bold"
                        FontSize="17"
                        LineBreakMode="TailTruncation"
                        Text="{Binding ViewModel.Title, Mode=OneWay}" />
                    <Label
                        FontSize="13"
                        Opacity="0.5"
                        Text="{Binding ViewModel.FileTypeText, Mode=OneWay}" />
                </VerticalStackLayout>
            </Grid>

            <!--  Divider  -->
            <BoxView
                HeightRequest="1"
                Opacity="0.5"
                Color="{AppThemeBinding Light={StaticResource BorderLightColor},
                                        Dark={StaticResource BorderDarkColor}}" />

            <!--  Properties list  -->
            <VerticalStackLayout Padding="16,12,16,16" Spacing="0">

                <!--  Item Type  -->
                <uc:ItemProperty
                    Title="{l:ResourceString Rid=ItemType}"
                    Command="{Binding ViewModel.CopyPropertyCommand, Mode=OneWay}"
                    CommandParameter="ItemType"
                    IsLastItem="False"
                    Subtitle="{Binding ViewModel.FileTypeText, Mode=OneWay}" />

                <!--  Size  -->
                <uc:ItemProperty
                    Title="{l:ResourceString Rid=Size}"
                    Command="{Binding ViewModel.CopyPropertyCommand, Mode=OneWay}"
                    CommandParameter="Size"
                    IsLastItem="False"
                    IsVisible="{Binding ViewModel.SizeText, Mode=OneWay, Converter={StaticResource NullToBoolConverter}}"
                    Subtitle="{Binding ViewModel.SizeText, Mode=OneWay}" />

                <!--  Date Created (iOS only)  -->
                <OnPlatform x:TypeArguments="View">
                    <On Platform="iOS">
                        <uc:ItemProperty
                            Title="{l:ResourceString Rid=DateCreated}"
                            Command="{Binding ViewModel.CopyPropertyCommand, Mode=OneWay}"
                            CommandParameter="DateCreated"
                            IsLastItem="False"
                            Subtitle="{Binding ViewModel.DateCreatedText, Mode=OneWay}" />
                    </On>
                </OnPlatform>

                <!--  Date Modified  -->
                <uc:ItemProperty
                    Title="{l:ResourceString Rid=DateModified}"
                    Command="{Binding ViewModel.CopyPropertyCommand, Mode=OneWay}"
                    CommandParameter="DateModified"
                    IsLastItem="True"
                    Subtitle="{Binding ViewModel.DateModifiedText, Mode=OneWay}" />

            </VerticalStackLayout>
        </VerticalStackLayout>
    </Border>
</tv:Popup>
