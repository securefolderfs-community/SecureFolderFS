<ContentView
    x:Class="SecureFolderFS.Maui.UserControls.CommandBarControl"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:mi="http://www.aathifmahir.com/dotnet/2022/maui/icons"
    xmlns:mi_cupertino="clr-namespace:MauiIcons.Cupertino;assembly=MauiIcons.Cupertino"
    xmlns:mi_material="clr-namespace:MauiIcons.Material;assembly=MauiIcons.Material"
    xmlns:vc="clr-namespace:SecureFolderFS.Maui.ValueConverters"
    x:Name="ThisControl">

    <ContentView.Resources>
        <vc:NullToBoolConverter x:Key="NullToBoolConverter" />

        <LinearGradientBrush x:Key="BarGradient" StartPoint="0.5,0" EndPoint="0.5,1">
            <GradientStop Offset="0.5" Color="{AppThemeBinding Light={StaticResource ElevatedFillPrimaryLightColor}, Dark={StaticResource ElevatedFillPrimaryDarkColor}}" />
            <GradientStop Offset="1" Color="{AppThemeBinding Light={StaticResource LightTransparentColor}, Dark={StaticResource DarkTransparentColor}}" />
        </LinearGradientBrush>
    </ContentView.Resources>

    <Grid x:Name="RootGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="75" />
            <RowDefinition />
        </Grid.RowDefinitions>

        <Border
            x:Name="TopBorder"
            Grid.Row="0"
            Background="{StaticResource BarGradient}"
            HeightRequest="150"
            StrokeThickness="0"
            VerticalOptions="Start"
            ZIndex="5">

            <Grid
                Padding="16,0"
                Background="{StaticResource ThemeElevatedFillPrimaryColorBrush}"
                ColumnSpacing="16"
                HeightRequest="75"
                VerticalOptions="Start">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <Grid Grid.Column="0">
                    <OnPlatform x:TypeArguments="View">
                        <On Platform="Android">
                            <Button
                                Padding="12,8"
                                mi:MauiIcon.Value="{mi_material:Material Close,
                                                                         IconSize=20}"
                                Clicked="Close_Clicked"
                                Style="{StaticResource TransparentButtonStyle}"
                                VerticalOptions="Center" />
                        </On>
                        <On Platform="iOS">
                            <Button
                                Padding="12,8"
                                mi:MauiIcon.Value="{mi_cupertino:Cupertino Xmark,
                                                                           IconSize=20}"
                                Clicked="Close_Clicked"
                                Style="{StaticResource TransparentButtonStyle}" />
                        </On>
                    </OnPlatform>
                </Grid>

                <Label
                    Grid.Column="1"
                    FontAttributes="Bold"
                    FontSize="16"
                    HorizontalOptions="Start"
                    LineBreakMode="TailTruncation"
                    Text="{Binding Title, Source={x:Reference ThisControl}, Mode=OneWay}"
                    VerticalOptions="Center" />

                <OnPlatform x:TypeArguments="View">
                    <On Platform="Android">
                        <HorizontalStackLayout Grid.Column="2">
                            <Button
                                Padding="12,8"
                                mi:MauiIcon.Value="{mi_material:Material Share,
                                                                         IconSize=20}"
                                Command="{Binding ShareCommand, Source={x:Reference ThisControl}}"
                                IsVisible="{Binding ShareCommand, Converter={StaticResource NullToBoolConverter}, Source={x:Reference ThisControl}}"
                                Style="{StaticResource TransparentButtonStyle}"
                                VerticalOptions="Center" />
                            <Button
                                Padding="12,8"
                                mi:MauiIcon.Value="{mi_material:Material InfoOutline,
                                                                         IconSize=20}"
                                Command="{Binding PropertiesCommand, Source={x:Reference ThisControl}}"
                                IsVisible="{Binding PropertiesCommand, Converter={StaticResource NullToBoolConverter}, Source={x:Reference ThisControl}}"
                                Style="{StaticResource TransparentButtonStyle}"
                                VerticalOptions="Center" />
                        </HorizontalStackLayout>
                    </On>
                    <On Platform="iOS">
                        <HorizontalStackLayout Grid.Column="2">
                            <Button
                                Padding="12,8"
                                mi:MauiIcon.Value="{mi_cupertino:Cupertino TrayArrowUp,
                                                                           IconSize=20}"
                                Command="{Binding ShareCommand, Source={x:Reference ThisControl}}"
                                IsVisible="{Binding ShareCommand, Converter={StaticResource NullToBoolConverter}, Source={x:Reference ThisControl}}"
                                Style="{StaticResource TransparentButtonStyle}" />
                            <Button
                                Padding="12,8"
                                mi:MauiIcon.Value="{mi_cupertino:Cupertino InfoCircle,
                                                                           IconSize=20}"
                                Command="{Binding PropertiesCommand, Source={x:Reference ThisControl}}"
                                IsVisible="{Binding PropertiesCommand, Converter={StaticResource NullToBoolConverter}, Source={x:Reference ThisControl}}"
                                Style="{StaticResource TransparentButtonStyle}" />
                        </HorizontalStackLayout>
                    </On>
                </OnPlatform>
            </Grid>
        </Border>

        <ContentView
            x:Name="MainContent"
            Grid.Row="0"
            Grid.RowSpan="2"
            Content="{Binding InnerContent, Source={x:Reference ThisControl}, Mode=OneWay}"
            HorizontalOptions="Fill"
            Loaded="MainContent_Loaded"
            VerticalOptions="Fill" />
    </Grid>
</ContentView>
