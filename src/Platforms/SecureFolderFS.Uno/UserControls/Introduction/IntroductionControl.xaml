<UserControl
    x:Class="SecureFolderFS.Uno.UserControls.Introduction.IntroductionControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:l="using:SecureFolderFS.Uno.Localization"
    xmlns:local="using:SecureFolderFS.Uno.UserControls.Introduction"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:tui="using:CommunityToolkit.WinUI"
    xmlns:vc="using:SecureFolderFS.Uno.ValueConverters"
    xmlns:win="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    PreviewKeyDown="IntroductionControl_KeyDown"
    mc:Ignorable="d">

    <UserControl.Resources>
        <vc:IndexToProgressConverter x:Key="IndexToProgressConverter" />
        <!--  Fade In + Scale In Animation  -->
        <Storyboard x:Key="ShowOverlayStoryboard" x:Name="ShowOverlayStoryboard">
            <DoubleAnimation
                Storyboard.TargetName="RootGrid"
                Storyboard.TargetProperty="Opacity"
                From="0"
                To="1"
                Duration="0:0:0.25">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation
                Storyboard.TargetName="RootGrid"
                Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.ScaleX)"
                From="0.95"
                To="1"
                Duration="0:0:0.25">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation
                Storyboard.TargetName="RootGrid"
                Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.ScaleY)"
                From="0.95"
                To="1"
                Duration="0:0:0.25">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseOut" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>

        <!--  Fade Out + Scale Out Animation  -->
        <Storyboard x:Key="HideOverlayStoryboard" x:Name="HideOverlayStoryboard">
            <DoubleAnimation
                Storyboard.TargetName="RootGrid"
                Storyboard.TargetProperty="Opacity"
                To="0"
                Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseIn" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation
                Storyboard.TargetName="RootGrid"
                Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.ScaleX)"
                To="0.95"
                Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseIn" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
            <DoubleAnimation
                Storyboard.TargetName="RootGrid"
                Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.ScaleY)"
                To="0.95"
                Duration="0:0:0.2">
                <DoubleAnimation.EasingFunction>
                    <CubicEase EasingMode="EaseIn" />
                </DoubleAnimation.EasingFunction>
            </DoubleAnimation>
        </Storyboard>
    </UserControl.Resources>

    <Grid
        x:Name="RootGrid"
        RenderTransformOrigin="0.5,0.5"
        RowSpacing="16">
        <Grid.RenderTransform>
            <CompositeTransform />
        </Grid.RenderTransform>
        <Grid.ColumnDefinitions>
            <ColumnDefinition />
            <ColumnDefinition Width="14*" />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition />
            <RowDefinition Height="10*" />
            <RowDefinition />
        </Grid.RowDefinitions>
        <WebView2
            x:Name="BackgroundWebView"
            Grid.Row="0"
            Grid.RowSpan="3"
            Grid.Column="0"
            Grid.ColumnSpan="3"
            DefaultBackgroundColor="Transparent"
            Loaded="BackgroundWebView_Loaded" />

        <Border
            x:Name="ShadowTarget"
            Grid.Row="1"
            Grid.Column="1" />

        <Grid
            Grid.Row="1"
            Grid.Column="1"
            CornerRadius="8">

            <!--  TODO: Not supported on non_win platforms. Implement and use OnPlatform  -->
            <!-- <tui:Effects.Shadow> -->
            <!--  <tui:AttachedDropShadow  -->
            <!--  BlurRadius="10"  -->
            <!--  CastTo="{x:Bind ShadowTarget}"  -->
            <!--  CornerRadius="8"  -->
            <!--  Opacity="0.6" />  -->
            <!-- </tui:Effects.Shadow> -->

            <FlipView x:Name="SlidesFlipView" SelectedIndex="{x:Bind ViewModel.CurrentIndex, Mode=TwoWay}">
                <!--  Views  -->
                <local:WelcomeScreen />
                <local:FeatureSlide
                    Title="{l:ResourceString Rid=OnboardingDashboardTitle}"
                    Description="{l:ResourceString Rid=OnboardingDashboardSubtitle}"
                    ImageSource="ms-appx://SecureFolderFS.UI/Assets/AppAssets/Introduction/intro_light_dashboard.png" />
                <local:EndScreen CloseCommand="{x:Bind HideCommand, Mode=OneWay}" />
            </FlipView>
        </Grid>
    </Grid>
</UserControl>
