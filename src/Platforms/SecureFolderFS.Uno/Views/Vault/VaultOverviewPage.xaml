<Page
    x:Class="SecureFolderFS.Uno.Views.Vault.VaultOverviewPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:l="using:SecureFolderFS.Uno.Localization"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ts="using:SecureFolderFS.Uno.TemplateSelectors"
    xmlns:uc="using:SecureFolderFS.Uno.UserControls"
    xmlns:ucab="using:SecureFolderFS.Uno.UserControls.ActionBlocks"
    xmlns:ucw="using:SecureFolderFS.Uno.UserControls.Widgets"
    xmlns:vm="using:SecureFolderFS.Sdk.ViewModels.Controls.Widgets"
    xmlns:vm2="using:SecureFolderFS.Sdk.ViewModels.Controls.Widgets.Health"
    xmlns:vm3="using:SecureFolderFS.Sdk.ViewModels.Controls.Widgets.Data"
    NavigationCacheMode="Disabled"
    mc:Ignorable="d">

    <Page.Resources>
        <!--  Vault Health  -->
        <DataTemplate x:Key="HealthWidgetTemplate" x:DataType="vm2:HealthWidgetViewModel">
            <ucw:HealthWidget
                CancelCommand="{x:Bind HealthViewModel.CancelScanningCommand, Mode=OneWay}"
                CurrentProgress="{x:Bind HealthReportViewModel.HealthViewModel.CurrentProgress, Mode=OneWay}"
                IsProgressing="{x:Bind HealthReportViewModel.HealthViewModel.IsProgressing, Mode=OneWay}"
                LastCheckedText="{x:Bind LastCheckedText, Mode=OneWay}"
                OpenVaultHealthCommand="{x:Bind OpenVaultHealthCommand, Mode=OneWay}"
                Severity="{x:Bind HealthReportViewModel.HealthViewModel.Severity, Mode=OneWay}"
                StartScanningCommand="{x:Bind HealthViewModel.StartScanningCommand, Mode=OneWay}"
                StatusTitle="{x:Bind HealthViewModel.Title, Mode=OneWay}" />
        </DataTemplate>

        <!--  Resource Graphs  -->
        <DataTemplate x:Key="GraphsWidgetTemplate" x:DataType="vm3:GraphsWidgetViewModel">
            <ucw:GraphsWidget
                ReadGraphData="{x:Bind ReadGraphViewModel.Data, Mode=OneWay}"
                ReadGraphIsExtended="{x:Bind ReadGraphViewModel.IsExtended, Mode=TwoWay}"
                ReadGraphSubheader="{x:Bind ReadGraphViewModel.GraphSubHeader, Mode=OneWay}"
                WriteGraphData="{x:Bind WriteGraphViewModel.Data, Mode=OneWay}"
                WriteGraphIsExtended="{x:Bind WriteGraphViewModel.IsExtended, Mode=TwoWay}"
                WriteGraphSubheader="{x:Bind WriteGraphViewModel.GraphSubHeader, Mode=OneWay}" />
        </DataTemplate>

        <!--  Aggregated Data Statistics Widget  -->
        <DataTemplate x:Key="AggregatedDataWidgetTemplate" x:DataType="vm3:AggregatedDataWidgetViewModel">
            <ucw:AggregatedDataWidget TotalRead="{x:Bind TotalRead, Mode=OneWay}" TotalWrite="{x:Bind TotalWrite, Mode=OneWay}" />
        </DataTemplate>
    </Page.Resources>

    <!--  Margins are to align the scrollbar to prevent overlap with content  -->
    <ScrollViewer Margin="-12,0,-12,0">
        <StackPanel Margin="12,0,12,0" Spacing="8">
            <!--  Widgets  -->
            <ItemsRepeater x:Name="WidgetsList" ItemsSource="{x:Bind ViewModel.WidgetsViewModel.Widgets, Mode=OneWay}">
                <ItemsRepeater.ItemTemplate>
                    <DataTemplate x:DataType="vm:BaseWidgetViewModel">
                        <ContentControl
                            HorizontalContentAlignment="Stretch"
                            VerticalContentAlignment="Stretch"
                            Content="{Binding}">
                            <ContentControl.ContentTemplateSelector>
                                <ts:WidgetsTemplateSelector
                                    AggregatedDataWidgetTemplate="{StaticResource AggregatedDataWidgetTemplate}"
                                    GraphsWidgetTemplate="{StaticResource GraphsWidgetTemplate}"
                                    HealthWidgetTemplate="{StaticResource HealthWidgetTemplate}" />
                            </ContentControl.ContentTemplateSelector>
                        </ContentControl>
                    </DataTemplate>
                </ItemsRepeater.ItemTemplate>
            </ItemsRepeater>

            <!--  Vault Controls  -->
            <uc:VaultControls
                IsReadOnly="{x:Bind ViewModel.UnlockedVaultViewModel.Options.IsReadOnly, Mode=OneWay}"
                LockVaultCommand="{x:Bind ViewModel.VaultControlsViewModel.LockVaultCommand, Mode=OneWay}"
                OpenPropertiesCommand="{x:Bind ViewModel.VaultControlsViewModel.OpenPropertiesCommand, Mode=OneWay}"
                RevealFolderCommand="{x:Bind ViewModel.VaultControlsViewModel.RevealFolderCommand, Mode=OneWay}" />
        </StackPanel>
    </ScrollViewer>
</Page>
